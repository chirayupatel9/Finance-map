// Nextflow configuration for taxprofiler tutorial
// Comparing Kraken2, Centrifuge, and Kaiju

params {
    // Input/output options
    input = 'samplesheet.csv'
    databases = 'database.csv'
    outdir = 'results'

    // Enable all three profilers
    run_kraken2 = true
    run_centrifuge = true
    run_kaiju = true

    // Performance profiling
    run_profile_standardisation = true

    // Generate Krona plots for visualization
    run_krona = true

    // Skip preprocessing steps if data is already clean
    perform_shortread_qc = false
    perform_shortread_hostremoval = false
    perform_shortread_complexityfilter = false
    perform_runmerging = false

    // Max resource options
    // Adjust these based on your HPC cluster resources
    max_memory = '128.GB'
    max_cpus = 16
    max_time = '48.h'
}

// Process specific configurations
process {
    // Error strategy
    errorStrategy = 'retry'
    maxRetries = 2

    // Resource labels
    withLabel: process_low {
        cpus = 2
        memory = 8.GB
        time = 4.h
    }
    withLabel: process_medium {
        cpus = 6
        memory = 32.GB
        time = 8.h
    }
    withLabel: process_high {
        cpus = 12
        memory = 64.GB
        time = 16.h
    }
}

// Execution profiles
profiles {
    // Local execution profile
    local {
        process.executor = 'local'
    }

    // SLURM cluster profile
    slurm {
        process {
            executor = 'slurm'
            queue = 'normal'
            clusterOptions = '--account=eces450650'
        }
        executor {
            queueSize = 10
            submitRateLimit = '10 sec'
        }
    }

    // PBS cluster profile
    pbs {
        process {
            executor = 'pbs'
            queue = 'workq'
        }
    }
}

// Singularity/Docker settings
singularity {
    enabled = true
    autoMounts = true
    cacheDir = "$HOME/.singularity_cache"
}

// Report options
timeline {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_timeline.html"
}

report {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_report.html"
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_info/execution_trace.txt"
}

dag {
    enabled = true
    file = "${params.outdir}/pipeline_info/pipeline_dag.svg"
}
